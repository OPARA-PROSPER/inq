#!/usr/bin/env ruby

require "how_is"
require "how_is/cli"
require "how_is/cli/parser"

begin
  parser  = HowIs::CLI::Parser.new
  result  = parser.call(ARGV)
rescue HowIs::CLI::OptionsError => e
  if ENV['SHOW_TRACE']
    raise
  else
    abort "Error: #{e.message}"
  end
end

opts      = result[:opts]
options   = result[:options]
arguments = result[:arguments]

begin
  if options[:help]
    puts result[:opts]
  elsif options[:version]
    puts HowIs::VERSION
  elsif options[:config]
    HowIs::CLI.new.from_config_file(options[:config])
  else
    HowIs.generate_report_file(options)
  end
rescue => e
  if ENV['SHOW_TRACE']
    raise
  else
    abort "Error: #{e.message}"
  end
end

